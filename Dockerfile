FROM phusion/passenger-ruby19

MAINTAINER yiqing.xu@chaintin.com

COPY ./res /home

RUN mv /home/passenger-install-apache2-module /usr/bin/passenger-install-apache2-module \
	&& mkdir /home/src \
	&& mv /home/sources.list /etc/apt/sources.list \
	&& apt -y update ; exit 0

RUN apt install -y apache2 \
	&& cd /var/www/html \
	&& rm -rf ./* \
	&& tar -zxvf /home/test.tar.gz -C /var/www/html \
	&& mv /home/000-Default.conf /etc/apache2/sites-enabled/000-default.conf \
	&& gem install bundler -v 1.3.5 \
	&& apt install -y libmagickcore-dev libmagickwand-dev imagemagick \
	&& cd /var/www/html && bundle install \
	&& export DEBIAN_FRONTEND="noninteractive" \
	&& apt install -y debconf-utils \
	&& /bin/bash /home/mysql.sh \
	&& apt install -y mysql-server \
	&& apt install -y mysql-client \
	&& apt install -y mongodb \
	&& /usr/bin/passenger-install-apache2-module \
	&& chmod 777 /home/start.sh \
	&& tar -zxvf /home/font.tar.gz -C /usr/share/fonts \
	&& mv /home/start.sh /start.sh

EXPOSE 80

CMD ["/start.sh"]
